<!-- Отображение корректировки заявки -->


<%= content_tag :main, id: :io_correction_products do %>

  <%= content_tag :h1, '', data: { text: "Коригування заявки № #{@io_correction.number} від" } %>

  <%= content_tag :div, '', id: :panel_main do %>
    <%= content_tag :div, '', class: :panel do %>
      <%= button_tag '', class: :btn_send, id: :send_sa, disabled: @io_correction.date_sa, data: { ajax_path: "#{institution_orders_send_sa_path}?id=#{@io_correction.id}" } %>
      <%= button_tag '', class: (@io_correction.date_sa ? :btn_exit : :btn_save), onclick: "location.href='#{institution_orders_index_path}'" %>

      <% if @io_correction.date_sa %>
        <%= label_tag '', 'Надіслано:' %>
        <%= label_tag :number, 'документ' %>
        <%= content_tag :nav, '', class: :icon_number do text_field_tag( :number_sa, @io_correction.number_sa, disabled: true ) end %>
        <%= label_tag :date, 'від' %>
        <%= content_tag :nav, '', class: :icon_сalendar do text_field_tag( :date, date_str(@io_correction.date_sa), disabled: true ) end %>
      <% end %>
    <% end %>

    <%= content_tag :div, '', class: :panel do %>
      <%= label_tag :number, 'Коригування заявки № ' %>
      <%= content_tag :nav, '', class: :icon_number do text_field_tag( :number, @io_correction.number, disabled: true ) end %>

      <%= label_tag :date, 'від' %>
      <%= content_tag :nav, '', class: :icon_сalendar do %>
        <%= text_field_tag :date, date_str(@io_correction.date), disabled: @io_correction.date_sa, readonly: true, data: { ajax_path: "#{institution_orders_correction_update_path}?id=#{@io_correction.id}" } %>
      <% end %>

      <%= label_tag :splendingdate, 'до заявки №' %>
      <%= content_tag :nav, '', class: :icon_number do text_field_tag( :institution_order_number, @institution_order.number, disabled: true ) end %>
    <% end %>
  <% end %>

  <% if @io_correction_products %>
    <%= content_tag :h2, "Продукти харчування" %>

    <%= content_tag :div, '', id: :table_io_correction_products do %>
      <%= content_tag :table, '', class: :table  do %>

        <% for i in 1..5 do %>
          <%= content_tag :col %>
        <% end %>

        <%= content_tag :thead do %>
          <%= content_tag :tr do %>
            <%= content_tag :th, 'Продукт харчування' %>
            <%= content_tag :th, 'Замовлено' %>
            <%= content_tag :th, 'Коригування' %>
            <%= content_tag :th, 'Після коригування' %>
            <%= content_tag :th, 'Додаткова інформація' %>
          <% end %>
        <% end %>

        <%= content_tag :tbody do %>
          <% date = '' %>
          <% @io_correction_products.each do | io_correction_product | %>
            <% if date != io_correction_product.date %>
              <% date = io_correction_product.date %>
              <%= content_tag :tr do content_tag( :td, date_str(date), colspan: 5, class: :row_group ) end %>
            <% end %>

            <%= content_tag :tr do %>
              <%= content_tag :td, io_correction_product.name %>
              <%= content_tag :td, f3_to_s( io_correction_product.count ), id: "count_#{io_correction_product.product_id}" %>

              <% [ :diff, :result ].each do | value | %>
                <% value_count = f3_to_s( value == :diff ? io_correction_product.diff : io_correction_product.result )  %>

                <%= content_tag :td do %>
                  <% if @io_correction.date_sa.nil? %>
                    <%= text_field_tag "#{value}_#{io_correction_product.product_id}", value_count, data: { ajax_path: ("#{institution_orders_correction_product_update_path}?id=#{io_correction_product.id}" if value == :diff) } %>
                  <% else %>
                    <%= value_count %>
                  <% end %>
                <% end %>
              <% end %>
              <%= content_tag :td, io_correction_product.description %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

    <% end %>
  <% end %>

<% end %>









