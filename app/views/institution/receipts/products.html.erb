<!-- Отображение продуктов поступления -->

<%= content_tag :main, id: :receipt_products do %>
  <%= content_tag :h1, '', data: { text: "Поставка № #{ @receipt.number } від" } %>

  <%= content_tag :div, id: :panel_main do %>
    <%= content_tag :div, class: :panel do %>
      <%= button_tag '', class: :btn_send, id: :send_sa, disabled: @receipt.date_sa,
                     data: { ajax_path: "#{ institution_receipts_send_sa_path }?id=#{ @receipt.id }" } %>
      <%= button_tag '', class: ( @receipt.date_sa ? :btn_exit : :btn_save ),
                     onclick: "location.href='#{ institution_receipts_index_path }'" %>

      <% if @receipt.date_sa %>
        <%= label_tag '', 'Надіслано:' %>
        <%= label_tag :number_sa, 'документ' %>
        <%= content_tag :nav, class: :icon_number do
          text_field_tag( :number_sa, @receipt.number_sa, disabled: true ) end %>
        <%= label_tag :date_sa, 'від' %>
        <%= content_tag :nav, class: :icon_сalendar do
          text_field_tag( :date_sa, date_str( @receipt.date_sa ), disabled: true ) end %>
      <% end %>
    <% end %>

    <%= content_tag :div, class: :panel do %>
      <%= label_tag :number, 'Поставка №' %>
      <%= content_tag :nav, class: :icon_number do text_field_tag( :number, @receipt.number, disabled: true ) end %>

      <%= label_tag :invoice_number, 'Документ №' %>
      <%= content_tag :nav, class: :icon_number do text_field_tag( :invoice_number, @receipt.invoice_number,
                                                                   disabled: @receipt.date_sa ) end %>

      <%= label_tag :date, 'від' %>
      <%= content_tag :nav, class: :icon_сalendar do
        text_field_tag :date, date_str( @receipt.date ), disabled: @receipt.date_sa, readonly: true,
                       data: { ajax_path: "#{ institution_receipts_update_path }?id=#{ @receipt.id }" } end %>

      <%= label_tag :number, 'за замовленням №' %>
      <%= content_tag :nav, class: :icon_number do
        text_field_tag( :number, @receipt.supplier_order.number, disabled: true ) end %>
    <% end %>

    <%= content_tag :div, class: :panel do %>
      <%= label_tag '', 'Постачальник' %>
      <%= content_tag :nav, id: :supplier_name, class: :icon_number do
        text_field_tag( '', @receipt.supplier_order.supplier.name, disabled: true ) end %>
      <%= label_tag '', 'за договором №' %>
      <%= content_tag :nav, id: :contract_number, class: :icon_number do text_field_tag( '', @receipt.contract_number, disabled: true ) end %>
    <% end %>

  <% end %>

  <% if @receipt_products %>
    <%= content_tag :h2, "Продукти харчування" %>

    <%= content_tag :div, id: :table_receipt_products do %>
      <%= content_tag :table, class: :table  do %>

        <% for i in 1..2 do %>
          <%= content_tag :col %>
        <% end %>

        <%= content_tag :thead do %>
          <%= content_tag :tr do %>
            <%= content_tag :th, 'Продукт харчування' %>
            <%= content_tag :th, 'Кількість' %>
          <% end %>
        <% end %>

        <%= content_tag :tbody do %>
          <% date = '' %>
          <% @receipt_products.each do | receipt_product | %>
            <% if date != receipt_product.date %>
              <% date = receipt_product.date %>
              <%= content_tag :tr do content_tag( :td, "#{ day_of_week( date.wday ) } #{ date_str( date ) }",
                                                  colspan: 2, class: :row_group ) end %>
            <% end %>

            <%= content_tag :tr do %>
              <%= content_tag :td, receipt_product.product.name %>

              <%= content_tag :td do %>
                <% if @receipt.date_sa.nil? %>
                  <%= text_field_tag :count, f3_to_s( receipt_product.count ),
                                     data: { ajax_path: "#{ institution_receipts_product_update_path }?id=
                        #{ receipt_product.id }" } %>
                <% else %>
                  <%= f3_to_s( receipt_product.count ) %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>

    <% end %>
  <% end %>

<% end %>