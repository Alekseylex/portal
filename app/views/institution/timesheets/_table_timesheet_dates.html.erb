<!-- Табличка с поступлениями -->

<% if @timesheet_dates.present? %>

  <% date_ve = @timesheet.date_ve %>
  <% date_vb = @timesheet.date_vb %>
  <% count_days = date_ve.day - date_vb.day + 1 %>

  <%= content_tag :table, class: :table  do %>

    <% for i in 0..count_days do %>
      <%= content_tag :col %>
    <% end %>

    <%= content_tag :thead do %>
      <%= content_tag :tr do %>
        <%= content_tag :th, 'Дитина' %>
        <% ( date_vb..date_ve ).each do | v | %>
          <%= content_tag :th, "#{ v.day } #{ short_day_of_week( v.wday ) }" %>
        <% end %>
      <% end %>
    <% end %>

    <%= content_tag :tbody do %>
      <% category_name = '' %>
      <% group_name = '' %>

      <% @timesheet_dates.each do | timesheet_date | %>

        <% if category_name != timesheet_date.category_name %>
          <% category_name = timesheet_date.category_name %>
          <% group_name = '' %>
          <%= content_tag :tr do %>
            <%= content_tag( :td, category_name, class: [ :row_group, :category_name ] ) %>
            <%= content_tag( :td, '', class: [ :row_group, :category_name ], colspan: count_days ) %>
          <% end %>
        <% end %>

        <% if group_name != timesheet_date.group_name %>
          <% group_name = timesheet_date.group_name %>
          <%= content_tag :tr do %>
            <%= content_tag( :td, group_name, class: [ :row_group, :group_name ] ) %>
            <%= content_tag( :td, '', class: [ :row_group, :group_name ], colspan: count_days ) %>
          <% end %>
        <% end %>

        <%= content_tag :tr do %>
          <%= content_tag :td, timesheet_date.child_name %>
          <% for i in 1..count_days do %>
            <%= content_tag :td, timesheet_date[ "d_#{i}" ].split( '_' )[ 2 ]  %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

<% end %>